global:
  resolve_timeout: 5m

route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 2h
  receiver: 'slack-default'
  routes:
    - matchers:
        - severity = "critical"
      receiver: 'slack-critical'
    - matchers:
        - severity = "warning"
      receiver: 'email-warning'

receivers:
  - name: 'slack-default'
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        send_resolved: true
        title: 'Agent Hotelero - Alert: {{ .CommonAnnotations.summary }}'
        text: |
          Severity: {{ .CommonLabels.severity }}
          Instance: {{ .CommonLabels.instance }}
          Description: {{ .CommonAnnotations.description }}

  - name: 'slack-critical'
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        send_resolved: true
        title: ':rotating_light: CRITICAL - {{ .CommonAnnotations.summary }}'
        text: |
          {{ range .Alerts }}â€¢ {{ .Annotations.description }} ({{ .Labels.instance }}){{ end }}

  - name: 'email-warning'
    email_configs:
      - to: '${ALERT_EMAIL}'
        from: '${ALERT_EMAIL_FROM:-alerts@example.com}'
        smarthost: '${SMTP_HOST:-smtp.example.com}:${SMTP_PORT:-587}'
        auth_username: '${SMTP_USER:-user}'
        auth_password: '${SMTP_PASS:-pass}'
        require_tls: true
