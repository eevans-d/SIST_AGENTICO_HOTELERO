# Guardrails Configuration
# Configuración central de límites y circuit breakers para evitar ciclos infinitos

## GitHub Workflows
WORKFLOW_TIMEOUT_CI=15           # minutos - CI workflow timeout
WORKFLOW_TIMEOUT_DEPLOY=25       # minutos - Deploy workflow timeout  
WORKFLOW_TIMEOUT_NIGHTLY=30      # minutos - Nightly scan timeout
WORKFLOW_TIMEOUT_STEP_DEFAULT=5  # minutos - Step timeout por defecto

## Dependabot
DEPENDABOT_PR_LIMIT_PYTHON=3     # PRs simultáneos para Python deps
DEPENDABOT_PR_LIMIT_DOCKER=2     # PRs simultáneos para Docker  
DEPENDABOT_PR_LIMIT_ACTIONS=2    # PRs simultáneos para GitHub Actions
DEPENDABOT_ONLY_SECURITY_PATCH=true  # Solo security y patch updates automáticos

## Health Check Sintético
HEALTH_CHECK_MAX_RETRIES=10      # máximo absoluto de reintentos
HEALTH_CHECK_MAX_TIMEOUT=60      # timeout máximo en segundos
HEALTH_CHECK_RATE_LIMIT=1        # delay mínimo entre requests (segundos)
HEALTH_CHECK_ALERT_COOLDOWN=300  # cooldown entre alertas (5 minutos)

## Docker Build
DOCKER_BUILD_TIMEOUT=600         # timeout para builds en segundos (10 min)
DOCKER_SCAN_TIMEOUT=300          # timeout para vulnerability scans (5 min)

## Trivy Security Scanning
TRIVY_TIMEOUT=300                # timeout para scans completos (5 min)
TRIVY_MAX_OUTPUT_SIZE=1048576    # máximo 1MB de output logs

## Circuit Breaker PMS (aplicación)
PMS_CB_FAILURE_THRESHOLD=5       # fallos antes de abrir CB
PMS_CB_RECOVERY_TIMEOUT=30       # segundos antes de intentar recovery
PMS_CB_HALF_OPEN_MAX_CALLS=3     # calls permitidas en half-open state

## Rate Limiting Redis
REDIS_RATE_LIMIT_WINDOW=60       # ventana en segundos
REDIS_RATE_LIMIT_MAX_REQUESTS=100 # requests máximos por ventana

## Monitoring & Alerting
ALERT_RATE_LIMIT_WINDOW=300      # ventana para rate limiting de alertas (5 min)
ALERT_MAX_PER_WINDOW=5           # máximo de alertas por ventana
PROMETHEUS_MAX_SERIES=1000000    # límite de series métricas
GRAFANA_QUERY_TIMEOUT=30         # timeout queries Grafana (segundos)

## Resource Limits
MAX_LOG_SIZE_MB=50               # tamaño máximo logs por workflow
MAX_ARTIFACT_SIZE_MB=100         # tamaño máximo artifacts
MAX_CONCURRENT_JOBS=3            # jobs concurrentes máximos

## Emergency Breakers (valores críticos)
EMERGENCY_DISK_USAGE_THRESHOLD=85   # % - detener workflows si disco >85%
EMERGENCY_MEMORY_USAGE_THRESHOLD=90 # % - kill procesos si memoria >90%
EMERGENCY_CPU_USAGE_THRESHOLD=95    # % - throttle si CPU >95%

## Validation Rules
# Estas reglas se aplican automáticamente en scripts y workflows:
# 1. Todos los timeouts tienen un máximo absoluto
# 2. Todos los retry loops tienen circuit breakers
# 3. Todas las alertas tienen rate limiting
# 4. Todos los builds tienen resource limits
# 5. Todos los scans tienen output size limits

## Usage in Scripts
# Para usar estos valores en bash scripts:
# source scripts/guardrails.conf
# MAX_RETRIES=${HEALTH_CHECK_MAX_RETRIES}